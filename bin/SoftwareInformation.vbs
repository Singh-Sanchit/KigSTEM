Const ForReading = 1
const ForAppending = 8
Set objFSO = CreateObject("Scripting.FileSystemObject")
Dim inputfile, datevalue, NIC1, Nic, StrIP
Set NIC1 = GetObject("winmgmts:").InstancesOf("Win32_NetworkAdapterConfiguration")
For Each Nic in NIC1
if Nic.IPEnabled then
StrIP = Nic.IPAddress(i)
end if
next
dtsnow = Now()
dd = Right("00" & Day(dtsnow), 2)
mm = Right("00" & Month(dtsnow), 2)
yy = Year(dtsnow)
datevalue = dd & "-" & mm & "-" & yy
inputfile = "..\kigSTEM\" & StrIP &" "& datevalue & " " & "Software_Information" & "" & ".csv"
Set reportfile = objFSO.OpenTextFile (inputfile, _
ForAppending, True)
Set objNetwork = CreateObject("Wscript.Network")
reportfile.writeline "Report Generated by : " & objNetwork.UserName
reportfile.WriteLine "Report generated on : " & Now
reportfile.writeline "<th>" & "," & "HostName" & "," & "</th>" & "," & "<th>" & "," & "Software" & "," & "</th>" & "," & "<th>" & "," & "Installation Date" & "," & "</th>" & "," & "<th>" & "," & "Version" & "," & "</th>" & "," & "<th>" & "," & "Size" & "," & "</th>"
srvIP = checkSoftware("localhost")
Function checksoftware(strcomputer)
	Const HKLM = &H80000002 'HKEY_LOCAL_MACHINE
	strComputer = strcomputer
	strKey = "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\"
	strEntry1a = "DisplayName"
	strEntry1b = "QuietDisplayName"
	strEntry2 = "InstallDate"
	strEntry3 = "VersionMajor"
	strEntry4 = "VersionMinor"
	strEntry5 = "EstimatedSize"
	Set objReg = GetObject("winmgmts://" & strComputer & "/root/default:StdRegProv")
	objReg.EnumKey HKLM, strKey, arrSubkeys

	For Each strSubkey In arrSubkeys
		intRet1 = objReg.GetStringValue(HKLM, strKey & strSubkey, strEntry1a, strValue1)
		If strValue1 <> "" Then
			objReg.GetStringValue HKLM, strKey & strSubkey, strEntry2, strValue2
  			If strValue2 <> "" Then
				d=CStr (strvalue2)
   			End If
	  		objReg.GetDWORDValue HKLM, strKey & strSubkey, strEntry3, intValue3
  			objReg.GetDWORDValue HKLM, strKey & strSubkey, strEntry4, intValue4
  			objReg.GetDWORDValue HKLM, strKey & strSubkey, strEntry5, intValue5
			If IsNull(strValue2) then
			Else
				strvalue2=Cstr(strValue2)
				dd=Mid(strValue2,7,2)
				mm=mid(strValue2,5,2)
				yy=mid(strValue2,1,4)
			End if
			intvalue5 = intValue5/1024
			If intvalue5 <> "" Then
				If intvalue3 >=0 then 
					If intvalue4 >=0 then
						reportfile.writeline "<tr>" & "," & "<td>" & "," & strcomputer & "," & "</td>" & "," &"<td>" & "," & strValue1 & "," & "</td>" & "," & "<td>" & "," & dd & "/" & mm & "/" & yy & "," & "</td>" & "," & "<td>" & "," & intValue3 & "." & intValue4 & "," & "</td>" & "," & "<td>" & "," & Round(intvalue5, 2) & " MB" & "," & "</td>" & "," & "</tr>"
					End If
				Else
					reportfile.writeline "<tr>" & "," & "<td>" & "," & strcomputer & "," & "</td>" & "," &"<td>" & "," & strValue1 & "," & "</td>" & "," & "<td>" & "," & dd & "/" & mm & "/" & yy & "," & "</td>" & "," & "<td>" & "," & " " & "," & "</td>" & " ," & "<td>" & "," & Round(intvalue5, 2) & " MB" & "," & "</td>" & "," & "</tr>"
				End If
			Else
				reportfile.writeline "<tr>" & "," & "<td>" & "," & strcomputer & "," & "</td>" & "," &"<td>" & "," & strValue1 & "," & "</td>" & "," & "<td>" & "," & dd & "/" & mm & "/" & yy & "," & "</td>" & "," & "<td>" & "," & intValue3 & "." & intValue4 & "," & "</td>" & "," & "<td>" & "," & " " & "," & "</td>" & "," & "</tr>"
			End If
		End If
	Next
End Function
